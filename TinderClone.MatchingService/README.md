# TinderClone.MatchingService

Микросервис для обработки свайпов, матчей и рекомендаций в приложении TinderClone.

## Функциональность

- **Обработка свайпов** - обработка лайков и дизлайков между пользователями
- **Определение матчей** - автоматическое создание матчей при взаимных лайках
- **Рекомендации пользователей** - получение кандидатов для свайпов с кешированием
- **Кеширование в Redis** - высокопроизводительное кеширование пользователей, свайпов и матчей

## Технологии

- .NET 8.0
- Redis (StackExchange.Redis) - кеширование данных
- RabbitMQ - асинхронная обработка событий и сообщений между микросервисами
- ASP.NET Core Web API
- Swagger/OpenAPI

## Redis Использование

Микросервис использует Redis для:

1. **Кеширования пользователей** - кеш профилей пользователей для быстрого доступа
2. **Кеширования свайпов** - хранение истории свайпов для предотвращения повторных свайпов
3. **Хранения матчей** - быстрый доступ к списку матчей пользователя
4. **Кеширования рекомендаций** - кеш рекомендаций для уменьшения нагрузки на основной API
5. **Скоринга пользователей** - хранение рейтингов пользователей

## RabbitMQ Использование

Микросервис использует RabbitMQ для:

1. **Асинхронной обработки событий** - отправка событий о создании матчей
2. **Обработки свайпов** - публикация событий о свайпах для других сервисов
3. **Синхронизации данных** - получение событий об обновлении пользователей
4. **Event-driven архитектуры** - слабая связность между микросервисами

### RabbitMQ Exchanges и Queues

- **matches.created** (Exchange) - события о создании матчей
- **swipes.processed** (Exchange) - события об обработке свайпов
- **users.updated** (Exchange) - события об обновлении пользователей
- **matching_service_user_updated** (Queue) - очередь для обновлений пользователей

## Запуск

### Требования

- .NET 8.0 SDK
- Redis (локально или через Docker)
- RabbitMQ (локально или через Docker)

### Запуск инфраструктуры через Docker

```bash
docker-compose up -d
```

Это запустит:
- Redis на порту 6379
- RabbitMQ на порту 5672 (AMQP) и 15672 (Management UI)

Доступ к RabbitMQ Management UI: http://localhost:15672 (guest/guest)

### Запуск микросервиса

```bash
dotnet run --project TinderClone.MatchingService
```

Микросервис будет доступен по адресу: `https://localhost:5001` или `http://localhost:5000`

## Конфигурация

Настройки находятся в `appsettings.json`:

```json
{
  "ConnectionStrings": {
    "Redis": "localhost:6379"
  },
  "MainApi": {
    "BaseUrl": "https://localhost:7000"
  },
  "RabbitMQ": {
    "HostName": "localhost",
    "Port": "5672",
    "UserName": "guest",
    "Password": "guest"
  }
}
```

## API Endpoints

### Swipe
- `POST /api/swipe` - обработка свайпа (лайк/дизлайк)

### Recommendations
- `GET /api/recommendations/{userId}` - получение рекомендаций для пользователя
- `POST /api/recommendations/get` - получение рекомендаций (с параметрами)

### Matches
- `GET /api/matches/{userId}` - получение списка матчей пользователя

## Интеграция с основным API

Микросервис взаимодействует с основным API через:
- **HTTP** для:
  - Получения данных пользователей
  - Получения рекомендаций
- **RabbitMQ** для:
  - Асинхронной отправки событий о создании матчей
  - Публикации событий о свайпах
  - Получения событий об обновлении пользователей

## Архитектура

Микросервис реализует event-driven архитектуру:
- **Redis** используется для быстрого доступа к данным (кеширование)
- **RabbitMQ** используется для асинхронной обработки событий между микросервисами
- **HTTP** используется для синхронных запросов данных

